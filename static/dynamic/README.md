# Docusaurus Extension: Dynamic Content

## Installation

## Compatibility

### Supported Version
- **@docusaurus/core**: 2.0.0-alpha.70
- **@docusaurus/preset-classic**: 2.0.0-alpha.70

This extension was written for, and verified to work with, the above-mentioned version of Docusaurus. 
Compatibility with future releases of Docusaurus is not guaranteed due to the nature of the
implementation.

### Breaking Changes
If updating Docusaurus causes this extension to break, it is most likely because of changes to
either the HTML structure of Docusaurus's pages or the behaviour of Docusaurus's included scripts. 

The technical functionality of this extension is explained in the [Implementation](#Implementation)
section below. To resolve breaking changes, read this section to understand how the extension works
and the potential points of failure. Systematically working through these implementation notes should
uncover the changes that have caused the extension to break.

## Implementation
To integrate dynamic PHP pages within the Docusaurus framework (designed for static content), some
sneeky (and non-optimal) workarounds have been employed.

Firstly, all dynamic pages must be placed within the `static/` directory to prevent Docusaurus from
processing them during compilation. All files in `static/` are copied, without modification, to the
root of the compiled website. For consistency, it is recommended that the dynamic pages are all placed 
within the `static/dynamic/pages/` directory (or in custom subdirectories within there).

Since these dynamic pages are not processed during compilation, Docusaurus has no knowledge of their
existence as potential page end-points. Therefore, navigating to these pages from the Docusaurus 
navigation system is not as simple as normal static pages. We fool Docusaurus into thinking we are
creating a navigation link to an external website (by providing the absolute URL for the "to" 
attribute) and instructing the browser to open this page in the current tab (by setting the "target" 
attribute to "_self"), as opposed to Docusaurus's default behaviour of opening a new tab.

This approach results in a page reload on changing to the dynamic page (instead of the normal 
behaviour of page switching being handled by React Router, without a page reload). Upon reloading
the page, Docusaurus reinitialises itself which leads to its imported scripts running again. These
scripts – besides enabling the interactive functionality of multiple Docusaurus features (e.g. dark 
mode, mobile navigation menu, website search, etc.) – initialise the React Router which handles the 
loading of page content without a full page reload. Since our dynamic pages were not processed during 
compilation, Docusaurus's scripts are not aware of them and the URL of the current dynamic page 
registers as "Not Found". The page content is automatically removed and the page title is changed to 
"Page Not Found".

To resolve this, the extension includes two additional client-side scripts to restore the dynamic
page content after Docusaurus removes it. These scripts are `page-capture.js` and `page-restore.js`,
the former executing before Docusaurus's scripts to capture the dynamic page content and the latter
executing after Docusaurus's scripts to replace the content. The `page-restore.js` script not only
restores the visible page content but also the associated metadata, including page title and 
description. Finally, it also highlights the navigation links to the current dynamic page. Script 
operation depends on certain elements of Docusaurus's HTML structure not changing, which presents 
the risk of breaking changes with Docusaurus updates.

Before listing which page elements are expected, it is worth explaining how the extension retrieves
the outer Docusaurus HTML (i.e. navigation bar, footer, etc.) required to embed the dynamic content.
To achieve this, the extension uses a reference file to retrieve the generated Docusaurus HTML 
structure. By default, this is the home page (generated by the compiler as `index.html`). The
chosen reference file is declared at the top of `static/dynamic/include/docusaurus.php` in the
`$DOCUSAURUS_TEMPLATE_FILE` variable.

The following elements are expected to be present (exactly as below) in the reference file (i.e. 
before page generation):
- `<div class="main-wrapper"> ... </div>` - containing the page content
- `<title data-react-helmet="true"> ... | ... </title>` - containing the page title
- `<meta data-react-helmet="true" property="og:title" content=" ... | ... ">` - containing the page title
- `<meta data-react-helmet="true" name="description" content=" ... ">` - containing the page description
- `<meta data-react-helmet="true" property="og:description" content=" ... ">` - containing the page description
- `<footer> ... </footer>` - containing the page footer

The following elements are expected to be present (exactly as below) after Docusaurus's scripts 
finishing run (i.e. before `page-restore.js` executes):
- `<div id="__docusaurus"> ... </div>` - containing the entire Docusaurus page structure
- `<title data-react-helmet="true"> ... | ... </title>` - containing the page title
- `<meta data-react-helmet="true" property="og:title" content=" ... | ... ">` - containing the page title
- `<footer> ... </footer>` - containing the page footer

## Usage

## Example